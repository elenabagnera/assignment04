---
title: "assignment04<eb1238>"
author: "Elena Bagnera"
date: "10/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(ggrepel)
```

## Fiscal decentralization across countries

```{r loading imfdata}
imf_fd <- read_dta('Data/Fiscal Decentralization STATA File - 2020 GFS Database Vintage (2).dta') 

```

```{r imfcleaning_graph1}
imf_fd_graph1 <- imf_fd %>%
  filter(year==2019) %>%
  select(country, sd_sng, rd_sng) %>%
  filter(country== "United States" | country== "Canada" |country== "New Zealand" | country=="Australia") %>%
  pivot_longer(
cols = c(sd_sng, rd_sng),
names_to = "FD_type",
values_to = "value"
  )
```

```{r imfgraph1}

imf_fd_graph1 %>% 
  ggplot() +
geom_col(mapping = aes(x = country, y = value, fill=FD_type), position="dodge")+
  theme_classic() + 
  xlab("Countries") + 
  ylab("% decentralized spending and revenue") +
  labs(caption="The data comes from the IMF fiscal decentralization database: https://data.imf.org/?sk=1C28EBFB-62B3-4B0C-AED3-048EEEBB684F") +
  labs(title = "Proportion of spending and revenue devolved to subnational governments", subtitle="2019: Australia, Canada, New Zealand, United States") +
 scale_fill_discrete(name = "Decentralization type", labels = c("Revenue decentralization", "Spending decentralization")) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot") 

# center title, change scale?
```

## Decentralization trends in Spain over time

```{r imfcleaning_graph2}
imf_fd_graph2 <- imf_fd %>%
  filter(country=="Spain") %>%
  filter(year>=1980) %>%
  select(country, year, sd_sng, rd_sng, taxd_sng) %>%
  pivot_longer(
cols = c(sd_sng, rd_sng, taxd_sng),
names_to = "FD_type",
values_to = "value"
  )
```


```{r imf_graph2}
imf_fd_graph2 %>% 
ggplot() +
geom_line(mapping = aes(x = year, y = value, color=FD_type), size=1) +
  geom_point(mapping = aes(x = year, y = value), size=1, color="dark blue") + # change size and color
  theme_classic() + 
  xlab("Years") + 
  ylab("Types of decentralization") +
  labs(caption="The data comes from the IMF fiscal decentralization database: https://data.imf.org/?sk=1C28EBFB-62B3-4B0C-AED3-048EEEBB684F") +
  labs(title = "Decentralization trends in Spain over time", subtitle="From 1980 to 2019", fill="") +
 scale_color_discrete(name = "Decentralization type", labels = c("Revenue decentralization", "Spending decentralization", "Tax revenue decentralization")) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot") 

## add scales (breaks) - ask if it counts. align caption?
```


## % of renewabe energy & population

```{r owid_data}
owid_energy <- read_csv('https://raw.githubusercontent.com/owid/energy-data/master/owid-energy-data.csv') 
```

```{r owid_cleaning}
owid_energy_graph1 <- owid_energy %>%
  filter(year==2019, !is.na(renewables_share_energy)) %>%
  select(country, year, population, renewables_share_energy) %>% # also need to remove regions
  mutate(population=log(population)) # best way to do this?
```


```{r owid_graph1}
owid_energy_graph1 %>%
    ggplot() +
  geom_point(mapping = aes(x = population, y = renewables_share_energy)) +
  geom_text_repel(aes(x=population, y=renewables_share_energy, label=country), size=3) + # only label 5 countries
  theme_classic() + 
  xlab("Population (log)") + 
  ylab("% of renewable energy in energy mix") +
  labs(caption="The data comes from the Our World In Data environmental database: https://ourworldindata.org/renewable-energy") +
  labs(title = "Relationship between country population and sare of renewable energy", subtitle="in 2019", fill="") +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot") 


# increasing max.overlaps, interpret log. Remove regions, only highlight some countries
```

```{r loading qogdata}
qog_en <- read_dta('Data/qog_std_ts_jan21.dta') 

```

## Something merged??


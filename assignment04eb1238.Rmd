---
title: "assignment04<eb1238>"
author: "Elena Bagnera"
date: "10/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(ggplot2)
library(ggrepel)
```

## Fiscal decentralization across countries

```{r loading imfdata}
imf_fd <- read_dta('Data/Fiscal Decentralization STATA File - 2020 GFS Database Vintage (2).dta') 

```

```{r imfcleaning_graph1}
imf_fd_graph1 <- imf_fd %>%
  filter(year==2019) %>%
  select(country, sd_sng, rd_sng) %>%
  filter(country== "United States" | country== "Canada" |country== "New Zealand" | country=="Australia")
```

```{r imfgraph1}

imf_fd_graph1 %>% ## alternatively can take mean across years and do more countries using facet?
  ggplot() +
geom_col(mapping = aes(x = country, y = sd_sng, fill=country), position="dodge")+
  theme_classic() + 
  xlab("Countries") + 
  labs(caption="The data comes from the IMF subnational finance database") +
  labs(title = "Comparison of tax revenue and expenditure decentralisation in 4 countries", subtitle="2019", fill="")
 
# center title, remove 0? , variable name
```

## Tax autonomy in OECD countries - or Spain over time?

```{r imfcleaning_graph2}
imf_fd_graph2 <- imf_fd %>%
  filter(country=="Spain") %>%
  filter(year>=1980) %>%
  select(country, year, sd_sng, rd_sng, taxd_sng) 
```


```{r imfgraph2}

imf_fd_graph2 %>% 
  ggplot() +
geom_line(mapping = aes(x = year, y = sd_sng), color="blue")+
  geom_line(mapping = aes(x = year, y = rd_sng), color="dark green")+
    geom_line(mapping = aes(x = year, y = taxd_sng), color="red")+
  geom_point(mapping = aes(x = year, y = taxd_sng)) + # change size and color
  theme_classic() + 
  xlab("Years") + 
  ylab("Types of decentralization") +
  labs(caption="The data comes from the IMF subnational finance database") +
  labs(title = "Decentralization trends in Spain over time", subtitle="from 1980 to 2019", fill="")

## add scales (breaks) - ask if it counts, add legend
```


## Some environmental (e.g. energy or CO2)

```{r owid_data}
owid_energy <- read_csv('https://raw.githubusercontent.com/owid/energy-data/master/owid-energy-data.csv') 
```

```{r owid_cleaning}
owid_energy_graph1 <- owid_energy %>%
  filter(year>=2019) %>%
  select(country, year, population, renewables_share_energy) %>% # also need to remove regions
  mutate(population=log(population)) # also need to rename it
```


```{r owid_graph1}
owid_energy_graph1 %>%
    ggplot() +
  geom_point(mapping = aes(x = population, y = renewables_share_energy)) +
  geom_text_repel(aes(x=population, y=renewables_share_energy, label=country), size=3) + # only label 5 countries
  theme_classic() + 
  xlab("Population (log)") + 
  ylab("Share of renewable energy") +
  labs(caption="The data comes from the Our World In Data environmental database") +
  labs(title = "Relationship between country population and sare of renewable energy", subtitle="in 2019", fill="")

# remove 2020, check if missings, increasing max.overlaps, interpret log
```

```{r loading qogdata}
qog_en <- read_dta('Data/qog_std_ts_jan21.dta') 

```

```{r regions_oecs}
regions_oecs <- read_csv('02-Source/REGION_SOCIAL_03102021202926451.csv') 
```

## Something merged??


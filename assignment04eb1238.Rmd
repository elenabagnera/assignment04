---
title: "assignment04<eb1238>"
author: "Elena Bagnera"
date: "10/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(ggrepel)
library(scales)
```

## Fiscal decentralization across countries

```{r loading imfdata}
imf_fd <- read_dta('Data/Fiscal Decentralization STATA File - 2020 GFS Database Vintage.dta') 

```

```{r imfcleaning_graph1}

countries <- c("United States", "Canada", "New Zealand", "Australia")

imf_fd_graph1 <- imf_fd %>%
  filter(year==2019) %>%
  select(country, sd_sng, rd_sng) %>%
  filter(country %in% countries) %>%
  pivot_longer(
cols = c(sd_sng, rd_sng),
names_to = "FD_type",
values_to = "value"
  )
```

```{r imfgraph1}

imf_fd_graph1 %>% 
  ggplot() +
  geom_col(mapping = aes(x = country, y = value, fill=FD_type), position="dodge")+
  theme_classic() + 
  xlab("Countries") + 
  ylab("% decentralized spending and revenue") +
  labs(caption="The data comes from the IMF fiscal decentralization database:\nhttps://data.imf.org/?sk=1C28EBFB-62B3-4B0C-AED3-048EEEBB684F") +
  labs(title = "Spending is more decentralized than tax revenue in former colonies of the British Empire", subtitle="2019") +
 scale_fill_discrete(name = "Decentralization type", labels = c("Revenue decentralization", "Spending decentralization")) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot") +
   scale_y_continuous(labels = scales::percent)

```

## Decentralization trends in Spain over time

```{r imfcleaning_graph2}
imf_fd_graph2 <- imf_fd %>%
  filter(country=="Spain") %>%
  filter(year>=1980) %>%
  select(country, year, sd_sng, rd_sng, taxd_sng) %>%
  pivot_longer(
cols = c(sd_sng, rd_sng, taxd_sng),
names_to = "FD_type",
values_to = "value"
  ) 

```

```{r imf_graph2}

imf_fd_graph2 %>% 
ggplot() +
geom_line(mapping = aes(x = year, y = value, color=FD_type), size=1, alpha= 0.8) +
  geom_point(mapping = aes(x = year, y = value), size=0.8, color="dark blue") + 
  theme_classic() + 
  xlab("Years") + 
  ylab("Degree of decentralization") +
  labs(caption="The data comes from the IMF fiscal decentralization database:\nhttps://data.imf.org/?sk=1C28EBFB-62B3-4B0C-AED3-048EEEBB684F") +
  labs(title = "Spain has undergone radical decentralization reforms", subtitle="From 1980 to 2019", fill="") +
 scale_color_discrete(name = "Decentralization type", labels = c("Revenue decentralization", "Spending decentralization", "Tax revenue decentralization")) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot")  +
  scale_y_continuous(labels = scales::percent_format(accuracy=1), limits=c(0, 0.5))
##  geom_text or annotate to remove legend and add lines
```


## % of renewabe energy & population

```{r owid_data}
owid_energy <- read_csv('https://raw.githubusercontent.com/owid/energy-data/master/owid-energy-data.csv') 
```

```{r owid_cleaning}

owid_energy_graph1 <- owid_energy %>%
  filter(
    year==2019, 
    !is.na(renewables_share_energy),
    !country %in% regions) %>%
  select(country, year, population, renewables_share_energy) 

regions <- c("North America", "Europe", "Asia", "World", "Africa")

highlights <- owid_energy_graph1 %>%
  filter(country=="China"| country=="India"| country=="United States" | country=="Russia"| country=="Brazil"| country=="Pakistan")


```


```{r owid_graph1}
owid_energy_graph1 %>%
    ggplot() +
  geom_point(mapping = aes(x = population, y = renewables_share_energy), color="dark green") +
  geom_text_repel(data=highlights, aes(x=population, y=renewables_share_energy, label=country), size=3) + # only label 5 countries
  theme_classic() + 
  xlab("Population") + 
  ylab("% of renewables in energy mix") +
  labs(caption="The data comes from the Our World In Data environmental database:\nhttps://ourworldindata.org/renewable-energy") +
  labs(title = "The most populous countries tend to have a low renewable levels in energy mix", subtitle="Our World in Data (2019)", fill="") +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot")+
  scale_x_log10(labels=scales::comma)


# make sure clear which countries
```

```{r loading qogdata}
qog_en <- read_dta('Data/qog_std_ts_jan21.dta') 

```

## Something merged/ a map?

```{r loading qogdata}
qog_en <- read_dta('Data/qog_std_ts_jan21.dta') 

```

